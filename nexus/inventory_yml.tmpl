all:
  children:
    nexus:
      hosts:
        "${hostname}":
          ansible_host: "${public_ip}"
  vars:
    #nexus_external_url: "https://${hostname}.${public_ip}.${domain}"
    ansible_user:  ${ssh_user}
    ansible_ssh_private_key_file: ~/.ssh/id_rsa

    nexus_timezone: 'Canada/Eastern'
    nexus_admin_password: "{{ vault_nexus_admin_password }}"
    nexus_public_hostname: "${hostname}.${public_ip}.${domain}"
    httpd_server_name: "${hostname}.${public_ip}.${domain}"
    httpd_setup_enable: true
    # httpd_ssl_certificate_file: "{{ vault_httpd_ssl_certificate_file }}"
    # httpd_ssl_certificate_key_file: "{{ vault_httpd_ssl_certificate_key_file }}"
    # ldap_connections:
    #   - ldap_name: 'Company LDAP'
    #     ldap_protocol: 'ldaps'
    #     ldap_hostname: 'ldap.company.com'
    #     ldap_port: 636
    #     ldap_search_base: 'dc=company,dc=net'
    #     ldap_user_base_dn: 'ou=users'
    #     ldap_user_object_class: 'inetOrgPerson'
    #     ldap_user_id_attribute: 'uid'
    #     ldap_user_real_name_attribute: 'cn'
    #     ldap_user_email_attribute: 'mail'
    #     ldap_group_base_dn: 'ou=groups'
    #     ldap_group_object_class: 'posixGroup'
    #     ldap_group_id_attribute: 'cn'
    #     ldap_group_member_attribute: 'memberUid'
    #     ldap_group_member_format: 'username'
    nexus_privileges:
      - name: all-repos-read
        description: 'Read & Browse access to all repos'
        repository: '*'
        actions:
          - read
          - browse
      - name: company-project-deploy
        description: 'Deployments to company-project'
        repository: company-project
        actions:
          - add
          - edit
    nexus_roles:
      - id: Developpers # maps to the LDAP group
        name: developers
        description: All developers
        privileges:
          - nx-search-read
          - all-repos-read
          - company-project-deploy
        roles: []
    nexus_local_users:
      - username: jenkins # used as key to update
        first_name: Jenkins
        last_name: CI
        email: support@company.com
        password: "s3cr3t"
        roles:
          - Developpers # role ID here
    nexus_blobstores:
      - name: company-artifacts
        path: /var/nexus/blobs/company-artifacts
    nexus_scheduled_tasks:
      - name: compact-blobstore
        cron: '0 0 22 * * ?'
        typeId: blobstore.compact
        taskProperties:
          blobstoreName: 'company-artifacts'
    nexus_repos_maven_proxy:
      - name: central
        remote_url: 'https://repo1.maven.org/maven2/'
        layout_policy: permissive
      - name: alfresco
        remote_url: 'https://artifacts.alfresco.com/nexus/content/groups/private/'
        remote_username: 'secret-username'
        remote_password: "{{ vault_alfresco_private_password }}"
      - name: jboss
        remote_url: 'https://repository.jboss.org/nexus/content/groups/public-jboss/'
      - name: vaadin-addons
        remote_url: 'https://maven.vaadin.com/vaadin-addons/'
      - name: jaspersoft
        remote_url: 'https://jaspersoft.artifactoryonline.com/jaspersoft/jaspersoft-repo/'
        version_policy: mixed
    nexus_repos_maven_hosted:
      - name: company-project
        version_policy: mixed
        write_policy: allow
        blob_store: company-artifacts
    nexus_repos_maven_group:
      - name: public
        member_repos:
          - central
          - jboss
          - vaadin-addons
          - jaspersoft
