---
- hosts: javaindocker
  become: true
  pre_tasks:
    - name: Update apt cache.
      apt: update_cache=true cache_valid_time=600
      when: ansible_os_family == 'Debian'
    - name: install pip3
      apt: name=python3-pip state=present
  roles:
    - role: buluma.java
      vars:
        java_type: jdk
        java_version: 8
  post_tasks:
    - name: install maven
      apt: name=maven state=present


- name: Install prometheus and Grafana
  become: true
  hosts: prometheus
  roles:
    - role: cloudalchemy.node_exporter
    - role: buluma.prometheus
      vars:
        prometheus_targets:
          node:
          - targets:
            - localhost:9100
        prometheus_components: [ "prometheus", "node_exporter" ]
    - role: buluma.grafana
      vars:
        grafana_version: 7.5.15
        grafana_use_provisioning: true
        grafana_security:
          admin_user: admin
          admin_password: enter_your_secure_password
        grafana_datasources:
          - name: prometheus
            type: prometheus
            access: proxy
            url: 'http://localhost:9090'
            basicAuth: false
        grafana_dashboards:
        - dashboard_id: 1860
          revision_id: 26
          datasource: prometheus

# https://github.com/stadtulm/a13-ansible/blob/master/main.yml